<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SB19 Live in Singapore - Your Story, Your Stage</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Animate.css for smooth transitions -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        /* Applying the Inter font family and ensuring smooth font rendering */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #000; /* Black background for a premium feel */
        }

        /* Custom gradient text for headlines */
        .gradient-text {
            background: linear-gradient(90deg, #4F46E5, #A855F7, #EC4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        /* Custom focus styles for form inputs */
        .form-input:focus {
            outline: none;
            border-color: #A855F7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2);
        }
        
        /* Styling for the background image to ensure it covers the screen with a dark overlay */
        .hero-bg {
            /* Default to landscape image for desktop */
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), url('sb19_banner.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* Use portrait image for mobile devices (e.g., screens less than 768px wide) */
        @media (max-width: 768px) {
            .hero-bg {
                background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), url('sb19_banner_portait.webp');
            }
        }

        /* Hide scrollbar for aesthetics */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
    </style>
</head>
<body class="hero-bg text-white">

    <div id="app-container" class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8 transition-opacity duration-500">

        <!-- Main Landing Page Content -->
        <main id="landing-content" class="text-center animate__animated animate__fadeIn">
            <header class="mb-8">
                <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-extrabold tracking-tight">
                    <span class="block">Your Story.</span>
                    <span class="block gradient-text">Your Stage.</span>
                </h1>
                <p class="mt-4 max-w-2xl mx-auto text-lg sm:text-xl text-gray-300">
                    SB19's journey resonates with every Filipino who dreams big. Now, it's your turn to be heard. Share your story for a chance to win an exclusive 1-for-1 promo to their Singapore concert.
                </p>
            </header>
            <button id="start-journey-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-8 rounded-full text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 shadow-lg">
                Share My Story
            </button>
        </main>

        <!-- Multi-Step Form Container -->
        <div id="form-container" class="hidden w-full max-w-2xl mx-auto">
            <div id="form-card" class="bg-black bg-opacity-50 backdrop-blur-xl border border-gray-700 rounded-2xl p-6 sm:p-8 shadow-2xl">
                <!-- Step Indicator -->
                <div class="flex justify-center mb-6">
                    <div id="step-indicator" class="flex items-center space-x-2">
                        <!-- Indicators will be generated by JS -->
                    </div>
                </div>

                <!-- Form Steps -->
                <div id="form-steps">
                    <!-- Step 1: Basic Info -->
                    <div class="form-step animate__animated" data-step="1">
                        <h2 class="text-2xl font-bold text-center mb-1 gradient-text">Let's Get Started</h2>
                        <p class="text-center text-gray-400 mb-6">First, tell us who you are.</p>
                        <div class="space-y-4">
                            <input type="text" id="name" placeholder="Your Name" class="form-input w-full bg-gray-900 bg-opacity-70 border border-gray-700 rounded-lg px-4 py-3 text-white transition duration-300" required>
                            <input type="email" id="email" placeholder="Your Email" class="form-input w-full bg-gray-900 bg-opacity-70 border border-gray-700 rounded-lg px-4 py-3 text-white transition duration-300" required>
                            <input type="tel" id="contact" placeholder="Your Contact Number" class="form-input w-full bg-gray-900 bg-opacity-70 border border-gray-700 rounded-lg px-4 py-3 text-white transition duration-300" required>
                        </div>
                    </div>

                    <!-- Step 2: The "Why" -->
                    <div class="form-step hidden animate__animated" data-step="2">
                        <h2 class="text-2xl font-bold text-center mb-1 gradient-text">Your Winning Story</h2>
                        <p class="text-center text-gray-400 mb-6">From the heart, tell us...</p>
                        <textarea id="why-deserve" rows="5" placeholder="Why do you and a friend deserve to win this 1-for-1 promo to see SB19?" class="form-input w-full bg-gray-900 bg-opacity-70 border border-gray-700 rounded-lg px-4 py-3 text-white transition duration-300" required></textarea>
                    </div>

                    <!-- Step 3: The "Anthem" -->
                    <div class="form-step hidden animate__animated" data-step="3">
                        <h2 class="text-2xl font-bold text-center mb-1 gradient-text">Your Anthem</h2>
                        <p class="text-center text-gray-400 mb-6">Which SB19 song best describes your journey as a Filipino in Singapore?</p>
                        <select id="song-journey" class="form-input w-full bg-gray-900 bg-opacity-70 border border-gray-700 rounded-lg px-4 py-3 text-white transition duration-300 appearance-none" style="background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%236B7280%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 0.65em auto;" required>
                            <option value="" disabled selected>Choose Your Anthem</option>
                            <option value="Go Up">Go Up (The Dreamer's Anthem)</option>
                            <option value="Mapa">Mapa (The Family's Dedication)</option>
                            <option value="What?">What? (The Unapologetic Proclamation)</option>
                            <option value="Gento">Gento (The Grind to Gold)</option>
                            <option value="Dam">Dam (The Weight of Ambition)</option>
                            <option value="Ilaw">Ilaw (A Beacon of Hope)</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <!-- Step 4: The "Connection" -->
                    <div class="form-step hidden animate__animated" data-step="4">
                        <h2 class="text-2xl font-bold text-center mb-1 gradient-text">Your Pinoy Pride</h2>
                        <p class="text-center text-gray-400 mb-6">Tell us more about your journey.</p>
                        <div class="space-y-6"> <!-- Increased spacing between elements -->
                            <!-- Question 1: Time in SG -->
                            <div>
                                <label for="time-in-sg" class="block text-sm font-medium text-gray-300 mb-2">How long have you been in Singapore?</label>
                                <select id="time-in-sg" class="form-input w-full bg-gray-900 bg-opacity-70 border border-gray-700 rounded-lg px-4 py-3 text-white transition duration-300 appearance-none" style="background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%236B7280%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 0.65em auto;" required>
                                    <option value="" disabled selected>Select your duration</option>
                                    <option value="<1 year">< 1 year</option>
                                    <option value="1-5 years">1-5 years</option>
                                    <option value="5-10 years">5-10 years</option>
                                    <option value="10+ years">10+ years</option>
                                </select>
                            </div>
                            <!-- Question 2: Meaning of Success -->
                            <div>
                                <label for="meaning-of-success" class="block text-sm font-medium text-gray-300 mb-2">What does SB19's success mean to you as a Filipino living abroad?</label>
                                <textarea id="meaning-of-success" rows="4" placeholder="Share your thoughts here..." class="form-input w-full bg-gray-900 bg-opacity-70 border border-gray-700 rounded-lg px-4 py-3 text-white transition duration-300" required></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="mt-8 flex justify-between items-center">
                    <button id="prev-btn" class="text-gray-400 hover:text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300 hidden">
                        Back
                    </button>
                    <button id="next-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-6 rounded-full transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 shadow-lg ml-auto">
                        Next
                    </button>
                    <button id="submit-btn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold py-2 px-6 rounded-full transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50 shadow-lg ml-auto hidden">
                        Submit My Entry
                    </button>
                </div>
            </div>
        </div>

        <!-- Success Message Modal -->
        <div id="success-message" class="hidden text-center animate__animated animate__fadeIn w-full max-w-2xl mx-auto">
             <div class="bg-black bg-opacity-50 backdrop-blur-xl border border-gray-700 rounded-2xl p-8 sm:p-12 shadow-2xl">
                <div class="w-16 h-16 mx-auto mb-6 bg-green-500 rounded-full flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <h2 class="text-3xl font-bold gradient-text mb-2">Thank You!</h2>
                <p class="text-gray-300 text-lg">Your story has been received. We're inspired by your journey. Winners will be contacted via email. Good luck, A'TIN!</p>
             </div>
        </div>
        
        <!-- Loading Spinner -->
        <div id="loading-spinner" class="hidden">
            <svg class="animate-spin h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>

    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // This example uses placeholder Firebase config. 
        // For a real application, you would secure these keys.
        // NOTE: The user's provided Firebase config had an invalid API key format,
        // so I'm using a generic placeholder structure. 
        // Replace with your actual and valid Firebase configuration.
        const firebaseConfig = {
            apiKey: "AIzaSyBW_ljJTejCZs1CtIK8RLYzwx5b97r7Gbc",
            authDomain: "wordpair-f1515.firebaseapp.com",
            projectId: "wordpair-f1515",
            storageBucket: "wordpair-f1515.appspot.com",
            messagingSenderId: "172499436523",
            appId: "1:172499436523:web:bab73accafb475cf5f8fae",
            measurementId: "G-KS3F0WPHMZ"
        };

        // Declare variables in a higher scope to be accessible throughout the script
        let app, db;
        let getFirestore, collection, addDoc, serverTimestamp;

        // It's a good practice to wrap Firebase initialization in a try-catch block
        // to handle potential errors, for instance, if the CDN fails to load.
        try {
            // Import the functions you need from the SDKs
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
            // Destructure and assign the firestore functions to the variables declared above
            ({ getFirestore, collection, addDoc, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"));
            
            // Initialize Firebase
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase initialized successfully.");
        } catch (e) {
            console.error("Error initializing Firebase:", e);
            // In a real app, you might want to disable the form or show an error message.
        }
        
        // --- DOM Elements ---
        const landingContent = document.getElementById('landing-content');
        const formContainer = document.getElementById('form-container');
        const startJourneyBtn = document.getElementById('start-journey-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const formSteps = document.querySelectorAll('.form-step');
        const successMessage = document.getElementById('success-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        const stepIndicatorContainer = document.getElementById('step-indicator');

        // --- State ---
        let currentStep = 1;
        const totalSteps = formSteps.length;

        // --- Functions ---

        // Function to generate step indicators dynamically
        function createStepIndicators() {
            for (let i = 1; i <= totalSteps; i++) {
                const dot = document.createElement('div');
                dot.classList.add('w-3', 'h-3', 'rounded-full', 'transition-colors', 'duration-300');
                dot.dataset.step = i;
                stepIndicatorContainer.appendChild(dot);
            }
        }

        // Function to update the active step indicator's style
        function updateStepIndicator() {
            const dots = stepIndicatorContainer.querySelectorAll('div');
            dots.forEach(dot => {
                if (parseInt(dot.dataset.step) === currentStep) {
                    dot.classList.add('bg-indigo-500');
                    dot.classList.remove('bg-gray-600');
                } else {
                    dot.classList.remove('bg-indigo-500');
                    dot.classList.add('bg-gray-600');
                }
            });
        }

        // Function to show a specific step and hide others
        function showStep(stepNumber) {
            formSteps.forEach(step => {
                const stepEl = step;
                if (parseInt(stepEl.dataset.step) === stepNumber) {
                    stepEl.classList.remove('hidden');
                    stepEl.classList.remove('animate__fadeOut');
                    stepEl.classList.add('animate__fadeIn');
                } else {
                    stepEl.classList.add('hidden');
                }
            });
            updateStepIndicator();
            updateNavigationButtons();
        }

        // Function to update navigation buttons (Back, Next, Submit) visibility
        function updateNavigationButtons() {
            prevBtn.classList.toggle('hidden', currentStep === 1);
            nextBtn.classList.toggle('hidden', currentStep === totalSteps);
            submitBtn.classList.toggle('hidden', currentStep !== totalSteps);
        }

        // Function to validate the current step's inputs
        function validateStep(stepNumber) {
            const currentStepEl = document.querySelector(`.form-step[data-step="${stepNumber}"]`);
            const inputs = currentStepEl.querySelectorAll('input[required], textarea[required], select[required]');
            let isValid = true;

            inputs.forEach(input => {
                // Reset border color from any previous validation errors
                input.classList.remove('border-red-500');
                // Use the browser's built-in checkValidity method
                if (!input.checkValidity()) {
                    isValid = false;
                    input.classList.add('border-red-500'); // Highlight invalid fields
                }
            });
            return isValid;
        }

        // Function to handle the final form submission to Firebase
        async function handleSubmission() {
            if (!db || !addDoc || !collection || !serverTimestamp) {
                console.error("Firestore is not initialized correctly. Cannot submit form.");
                // Using a more user-friendly modal/message instead of alert() is recommended
                alert("Submission system is currently unavailable. Please try again later.");
                return;
            }

            // Provide visual feedback that submission is in progress
            submitBtn.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');

            const formData = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                contact: document.getElementById('contact').value.trim(),
                whyDeserve: document.getElementById('why-deserve').value.trim(),
                songJourney: document.getElementById('song-journey').value,
                timeInSg: document.getElementById('time-in-sg').value,
                meaningOfSuccess: document.getElementById('meaning-of-success').value.trim(),
                submittedAt: serverTimestamp() // Use server timestamp for consistency
            };

            try {
                // The functions are now available in this scope
                const docRef = await addDoc(collection(db, "sb19-sg-leads"), formData);
                console.log("Document written with ID: ", docRef.id);
                
                // Transition from form to success message
                const formCard = document.getElementById('form-card');
                formCard.classList.remove('animate__fadeIn');
                formCard.classList.add('animate__fadeOut');
                formCard.addEventListener('animationend', () => {
                    formContainer.classList.add('hidden');
                    successMessage.classList.remove('hidden');
                }, { once: true });

            } catch (e) {
                console.error("Error adding document: ", e);
                alert("There was an error submitting your story. Please check your connection and try again.");
                // Restore the UI to allow for another attempt
                loadingSpinner.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            }
        }

        // --- Event Listeners ---
        startJourneyBtn.addEventListener('click', () => {
            landingContent.classList.remove('animate__fadeIn');
            landingContent.classList.add('animate__fadeOut');
            landingContent.addEventListener('animationend', () => {
                landingContent.classList.add('hidden');
                formContainer.classList.remove('hidden');
                formContainer.querySelector('#form-card').classList.add('animate__animated', 'animate__fadeIn');
                showStep(currentStep);
            }, { once: true });
        });

        nextBtn.addEventListener('click', () => {
            if (validateStep(currentStep) && currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        });

        submitBtn.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent default form submission
             if (validateStep(currentStep)) {
                handleSubmission();
            }
        });

        // --- Initialization ---
        // Run these functions when the script loads
        createStepIndicators();
        showStep(currentStep);

    </script>
</body>
</html>
